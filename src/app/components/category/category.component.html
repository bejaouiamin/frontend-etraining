<!-- category.component.html -->
<div class="category-container">
  <!-- Background overlay -->
  <div class="background-overlay"></div>

  <!-- Main View -->
  <div class="content-wrapper">
    <!-- Header section -->
    <div class="header-section">
      <h1 class="main-title">Welcome back, ready for your next lesson?</h1>
      <button mat-button class="view-history-btn" (click)="viewHistory()">
        View history
        <mat-icon>arrow_forward</mat-icon>
      </button>
    </div>

    <!-- Loading state -->
    <div *ngIf="isLoadingHistory" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Chargement de votre historique...</p>
    </div>

    <!-- Lessons History Grid -->
    <div *ngIf="!isLoadingHistory && lessonHistory.length > 0" class="courses-grid">
      <!-- Lesson Card -->
      <mat-card *ngFor="let lesson of lessonHistory" class="course-card" (click)="goToLesson(lesson.lessonId)">
        <div class="image-container">
          <img src="images/meet.jpg" [alt]="lesson.lessonTitle" class="course-image">
          <div class="image-overlay"></div>
        </div>

        <mat-card-content>
          <h2 class="course-title">{{ lesson.lessonTitle }}</h2>

          <div class="lesson-meta-info">
            <span class="lesson-sequence">Leçon {{ lesson.sequenceOrder }}</span>
            <span class="lesson-resources">{{ lesson.completedResources }}/{{ lesson.totalResources }} ressources</span>
          </div>

          <div class="progress-section">
            <mat-progress-bar
              mode="determinate"
              [value]="lesson.progressPercentage"
              [color]="lesson.fullyCompleted ? 'accent' : 'primary'"
              class="progress-bar">
            </mat-progress-bar>
            <div class="progress-text">
              {{ lesson.progressPercentage | number:'1.0-0' }}% complété
            </div>
          </div>

          <div class="lesson-dates">
            <span *ngIf="lesson.lastActivityAt" class="date-info">
              <mat-icon>access_time</mat-icon>
              Dernière activité: {{ formatDate(lesson.lastActivityAt) }}
            </span>
            <mat-chip *ngIf="lesson.fullyCompleted" class="completion-chip completed">
              <mat-icon>check_circle</mat-icon>
              Complétée
            </mat-chip>
            <mat-chip *ngIf="!lesson.fullyCompleted" class="completion-chip in-progress">
              <mat-icon>schedule</mat-icon>
              En cours
            </mat-chip>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Empty state -->
    <div *ngIf="!isLoadingHistory && lessonHistory.length === 0" class="empty-state">
      <mat-icon>sentiment_dissatisfied</mat-icon>
      <p>Aucune leçon trouvée</p>
    </div>

    <!-- Navigation buttons -->
    <div class="navigation-buttons">
      <button mat-flat-button class="nav-btn prev-btn">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button mat-flat-button class="nav-btn next-btn">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  </div>

<!-- Top Categories Section -->
<div class="top-categories-container">
  <!-- Section Title - MAINTENANT AU-DESSUS -->
  <div class="section-header">
    <h2 class="top-category-title mat-typography">
      Choice favourite course from top category
    </h2>
  </div>

  <!-- Categories Grid -->
  <div class="categories-grid">
    <div class="category-card"
         [ngClass]="getColorClass(i)"
         *ngFor="let cat of categories; let i = index"
         (click)="goToCategory(cat.id)">
      <img [src]="iconPath(cat)" [alt]="cat.name + ' icon'" class="category-icon" (error)="onIconError($event)">
      <h3>{{ cat.name }}</h3>
      <p>{{ cat.description }}</p>
    </div>
  </div>
</div>

<!-- Recommended for you Section -->
<div class="recommended-container">
  <!-- Background overlay -->
  <div class="recommended-overlay"></div>

  <div class="recommended-content">
    <!-- Header -->
    <div class="recommended-header">
      <h2 class="recommended-title">Recommended for you</h2>
      <button mat-button class="see-all-btn">
        See all
      </button>
    </div>

    <!-- Loading state -->
    <div *ngIf="isLoadingRecommendations" class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Chargement des recommandations...</p>
    </div>

    <!-- Empty state -->
    <div *ngIf="!isLoadingRecommendations && recommendedThemes.length === 0" class="empty-state">
      <mat-icon>lightbulb_outline</mat-icon>
      <p>Aucune recommandation disponible pour le moment</p>
    </div>

    <!-- Courses Grid -->
    <div *ngIf="!isLoadingRecommendations && recommendedThemes.length > 0" class="recommended-grid">
      <!-- Dynamic Course Cards -->
      <mat-card *ngFor="let theme of recommendedThemes" class="recommended-card" (click)="goToTheme(theme.theme_id)">
        <div class="card-image-container">
          <img src="images/meet.jpg" [alt]="theme.theme_name" class="card-image">
          <div class="card-image-overlay"></div>
        </div>

        <mat-card-content class="card-content">
          <div class="card-meta">
            <span class="card-category">
              <mat-icon class="category-icon-small">{{ getCategoryIcon(theme.category) }}</mat-icon>
              {{ theme.category }}
            </span>
            <span class="card-score">
              <mat-icon class="score-icon">star</mat-icon>
              {{ (theme.recommendation_score * 100) | number:'1.0-0' }}%
            </span>
          </div>

          <h3 class="card-title">{{ theme.theme_name }}</h3>
          <p class="card-description">Recommandé pour vous par notre algorithme {{ theme.algorithm }}</p>

          <div class="card-footer">
            <div class="recommendation-badge">
              <mat-icon>recommend</mat-icon>
              <span>Recommandé</span>
            </div>
            <button mat-button color="primary" class="view-btn" (click)="goToTheme(theme.theme_id); $event.stopPropagation()">
              Voir le thème
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Navigation Arrows -->
    <div *ngIf="recommendedThemes.length > 0" class="recommended-nav">
      <button mat-mini-fab class="nav-arrow prev-arrow">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button mat-mini-fab class="nav-arrow next-arrow">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  </div>
</div>
