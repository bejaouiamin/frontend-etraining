<div class="quiz-attempt-container">
  <div class="header-section">
    <h1>
      <mat-icon>quiz</mat-icon>
      Tentative de Quiz
    </h1>
  </div>

  <div class="content-grid">
    <!-- Carte des informations du candidat -->
    <mat-card class="candidate-card">
      <mat-card-header>
        <mat-icon mat-card-avatar>person</mat-icon>
        <mat-card-title>Informations du candidat</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="isLoading" class="loading-spinner">
          <mat-spinner diameter="40"></mat-spinner>
        </div>
        <div *ngIf="!isLoading && candidate" class="candidate-info">
          <div class="info-row">
            <mat-icon>badge</mat-icon>
            <span class="label">Nom complet:</span>
            <span class="value">{{ candidate.fullName }}</span>
          </div>
          <div class="info-row">
            <mat-icon>email</mat-icon>
            <span class="label">Email:</span>
            <span class="value">{{ candidate.email }}</span>
          </div>
          <div class="info-row">
            <mat-icon>phone</mat-icon>
            <span class="label">Téléphone:</span>
            <span class="value">{{ candidate.phone }}</span>
          </div>
          <div class="info-row">
            <mat-icon>event</mat-icon>
            <span class="label">Date d'inscription:</span>
            <span class="value">{{ formatDate(candidate.dateInscription) }}</span>
          </div>
          <div class="info-row highlight">
            <mat-icon>emoji_events</mat-icon>
            <span class="label">Quiz réussis:</span>
            <mat-chip class="success-chip">{{ candidate.passedQuizCount || 0 }}</mat-chip>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Carte d'action du quiz -->
    <mat-card class="quiz-action-card">
      <mat-card-header>
        <mat-icon mat-card-avatar>assignment</mat-icon>
        <mat-card-title>Soumettre un Quiz</mat-card-title>
        <mat-card-subtitle>Resource ID: {{ resourceId }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="quiz-details">
          <div class="score-display">
            <mat-icon class="score-icon">grade</mat-icon>
            <div class="score-info">
              <span class="score-label">Score actuel</span>
              <span class="score-value">{{ score }}%</span>
            </div>
          </div>
          <p class="quiz-description">
            Cliquez sur le bouton ci-dessous pour soumettre votre tentative de quiz.
            Votre progression sera automatiquement enregistrée.
          </p>
        </div>
      </mat-card-content>
      <mat-card-actions>
        <button
          mat-raised-button
          color="primary"
          (click)="submitQuiz()"
          [disabled]="isLoading"
          class="submit-button">
          <mat-icon *ngIf="!isLoading">send</mat-icon>
          <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
          <span>{{ isLoading ? 'Soumission...' : 'Soumettre le Quiz' }}</span>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Historique des tentatives -->
  <mat-card class="history-card">
    <mat-card-header>
      <mat-icon mat-card-avatar>history</mat-icon>
      <mat-card-title>Historique des tentatives</mat-card-title>
      <mat-card-subtitle>{{ quizHistory.length }} tentative(s)</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="quizHistory.length === 0" class="no-history">
        <mat-icon>info</mat-icon>
        <p>Aucune tentative de quiz pour le moment</p>
      </div>
      <table mat-table [dataSource]="quizHistory" *ngIf="quizHistory.length > 0" class="history-table">
        <!-- Date Column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef>Date</th>
          <td mat-cell *matCellDef="let attempt">{{ formatDate(attempt.attemptedAt) }}</td>
        </ng-container>

        <!-- Score Column -->
        <ng-container matColumnDef="score">
          <th mat-header-cell *matHeaderCellDef>Score</th>
          <td mat-cell *matCellDef="let attempt">
            <span class="score-badge" [class.high-score]="attempt.score >= 70">
              {{ attempt.score }}%
            </span>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Statut</th>
          <td mat-cell *matCellDef="let attempt">
            <mat-chip [class.passed]="attempt.passed" [class.failed]="!attempt.passed">
              <mat-icon>{{ attempt.passed ? 'check_circle' : 'cancel' }}</mat-icon>
              {{ attempt.passed ? 'Réussi' : 'Échoué' }}
            </mat-chip>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
    </mat-card-content>
  </mat-card>
</div>
